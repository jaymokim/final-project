---
title: "Metropolis-Hastings"
author: "Seung Ah Ha, Jaymo Kim, Wonbin Song"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

### Metropolis-Hastings
```{r}
a <- 6
b <- 4

likelihood <- function(param){
  singlelikelihoods = dbeta(param, a, b, log = T)
}

prior <- function(param){
  pr = dunif(param, min=0, max=1, log = T)
  return(pr)
}

posterior <- function(param){
  return (exp(likelihood(param) + prior(param)))
}

metropolis_MCMC <- function(startvalue, iterations,c){
  chain = array(dim = c(iterations+1,1))
  chain[1,] = startvalue
  for (i in 1:iterations){
    proposal = rbeta(1, c*chain[i,], c*(1-chain[i,]))
    probab = dbeta(proposal,a,b)/dbeta(chain[i,],a,b)
    if (runif(1) < probab){
      chain[i+1,] = proposal
    }else{
      chain[i+1,] = chain[i,]
    }
  }
  return(chain)
}

startvalue <- runif(1, 0, 1)
chain=metropolis_MCMC(startvalue, 10000, c=1)

test <- rbeta(10000, 6, 4)

plot(chain, type='l')
par(mfrow=c(1,2))  
acf(chain); hist(chain)  

par(mfrow=c(1,2))
hist(test); hist(chain)
par(mfrow=c(1,1))

chain1=metropolis_MCMC(startvalue, 10000, c=0.1)
chain2=metropolis_MCMC(startvalue, 10000, c=2.5)
chain3=metropolis_MCMC(startvalue, 10000, c=10)

burnIn = 5000
acceptance1 = 1-mean(duplicated(chain1[-(1:burnIn),]))
acceptance2 = 1-mean(duplicated(chain2[-(1:burnIn),]))
acceptance3 = 1-mean(duplicated(chain3[-(1:burnIn),]))

plot(chain1, type='l')
par(mfrow=c(1,2))
acf(chain1)
hist(chain1, xlab = "Samples from chain", main = "Histogram of Chain, c = 0.1") 
hist(test, xlab = "Samples from Beta(6, 4)", main = "Histogram of Beta(6, 4)")
hist(chain1, xlab = "Samples from chain", main = "Histogram of Chain, c = 0.1")
par(mfrow=c(1,1))

plot(chain2, type='l')
par(mfrow=c(1,2))
acf(chain2)
hist(chain2, xlab = "Samples from chain", main = "Histogram of Chain, c = 2.5")
hist(test, xlab = "Samples from Beta(6, 4)", main = "Histogram of Beta(6, 4)")
hist(chain2, xlab = "Samples from chain", main = "Histogram of Chain, c = 2.5")
par(mfrow=c(1,1))

plot(chain3, type='l')
par(mfrow=c(1,2))
acf(chain3)
hist(chain3, xlab = "Samples from chain", main = "Histogram of Chain, c = 10")
hist(test, xlab = "Samples from Beta(6, 4)", main = "Histogram of Beta(6, 4)")
hist(chain3, xlab = "Samples from chain", main = "Histogram of Chain, c = 10")
```

